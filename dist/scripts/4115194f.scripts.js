"use strict";angular.module("riplive",["ngTouch","ngResource","ngRoute","ngSanitize","angular-carousel","ui.bootstrap","LocalStorageModule","ngDisqus"]).config(["$routeProvider","$locationProvider","$disqusProvider",function(a,b,c){b.html5Mode(!0).hashPrefix("!"),c.setShortname("riplive"),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/artists",{templateUrl:"views/artists-list.html",controller:"ArtistsCtrl"}).when("/artists/:slug",{templateUrl:"views/artist.html",controller:"ArtistCtrl"}).when("/artists/genre/:slug",{templateUrl:"views/artists-list.html",controller:"ArtistsGenreCtrl"}).when("/artists/tag/:slug",{templateUrl:"views/artists-list.html",controller:"ArtistsTagCtrl"}).when("/authors",{templateUrl:"views/authors-list.html",controller:"AuthorsCtrl"}).when("/authors/:slug",{templateUrl:"views/author.html",controller:"AuthorCtrl"}).when("/categories/:slug",{templateUrl:"views/news-list.html",controller:"CategoriesCtrl"}).when("/charts",{templateUrl:"views/charts.html",controller:"ChartsCtrl"}).when("/charts/:slug",{templateUrl:"views/chart.html",controller:"ChartCtrl"}).when("/news",{templateUrl:"views/news-list.html",controller:"NewsListCtrl"}).when("/news/:slug",{templateUrl:"views/news.html",controller:"NewsCtrl"}).when("/photos",{templateUrl:"views/photos.html",controller:"PhotosCtrl"}).when("/programs",{templateUrl:"views/programs.html",controller:"ProgramsCtrl"}).when("/programs/:slug",{templateUrl:"views/program.html",controller:"ProgramCtrl"}).when("/podcasts",{templateUrl:"views/podcasts-list.html",controller:"PodcastsCtrl"}).when("/podcasts/:program_slug",{templateUrl:"views/podcasts-list.html",controller:"PodcastsProgramCtrl"}).when("/podcasts/:program_slug/:id",{templateUrl:"views/podcast.html",controller:"PodcastCtrl"}).when("/schedule",{templateUrl:"views/schedule.html",controller:"ScheduleCtrl"}).when("/songs",{templateUrl:"views/songs-list.html",controller:"SongsCtrl"}).when("/songs/:slug",{templateUrl:"views/song.html",controller:"SongCtrl"}).when("/songs/genre/:slug",{templateUrl:"views/songs-list.html",controller:"SongsGenreCtrl"}).when("/songs/tag/:slug",{templateUrl:"views/songs-list.html",controller:"SongsTagCtrl"}).when("/tags/:slug",{templateUrl:"views/news-list.html",controller:"TagsCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("riplive").factory("artist",["$resource",function(a){return a("/api/artists/:slug",{slug:"@slug"},{get:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}},list:{isArray:!1,method:"GET",params:{count:24,page:"@page",divide:"@divide"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("artistGenre",["$resource",function(a){return a("/api/artists/genre/:slug",{slug:"@slug"},{list:{isArray:!1,method:"GET",params:{count:24,page:"@page",divide:"@divide"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("artistTag",["$resource",function(a){return a("/api/artists/tag/:slug",{slug:"@slug"},{list:{isArray:!1,method:"GET",params:{count:24,page:"@page",divide:"@divide"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("author",["$resource",function(a){return a("/api/authors/:slug",{slug:"@slug"},{get:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b.author}},list:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("category",["$resource",function(a){return a("/api/categories/:slug",{slug:"@slug"},{list:{isArray:!1,method:"GET",params:{count:12,page:"@page"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("chart",["$resource",function(a){return a("/api/charts/:slug",{slug:"@slug"},{get:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}},list:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("chartVote",["$resource",function(a){return a("/api/charts/vote",{},{save:{isArray:!1,method:"POST",transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("genreSong",["$resource",function(a){return a("/api/genres/songs/",{},{list:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("highlight",["$resource",function(a){return a("/api/highlights/:slug",{slug:"@slug"},{list:{isArray:!1,method:"GET",params:{count:6,page:"@page"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("news",["$resource",function(a){return a("/api/news/:slug",{slug:"@slug"},{get:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}},list:{isArray:!1,method:"GET",params:{count:24,page:"@page"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("podcast",["$resource",function(a){return a("/api/podcasts/:program_slug/:id",{program_slug:"@slug",id:"@id"},{get:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b.podcast}},list:{isArray:!1,method:"GET",params:{count:24,page:"@page"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("program",["$resource",function(a){return a("/api/programs/:slug",{slug:"@slug"},{get:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}},list:{isArray:!1,method:"GET",params:{count:24,page:"@page",podcast:"@podcast"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("schedule",["$resource",function(a){return a("/api/schedule",{slug:"@slug"},{list:{isArray:!0,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b.schedule}}})}]),angular.module("riplive").factory("search",["$resource",function(a){return a("/api/search",{},{list:{isArray:!1,method:"GET",params:{search:"@search",page:"@page",count:12},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("song",["$resource",function(a){return a("/api/songs/:slug",{slug:"@slug"},{get:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}},list:{isArray:!1,method:"GET",params:{count:24,page:"@page",divide:"@divide"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("songGenre",["$resource",function(a){return a("/api/songs/genre/:slug",{slug:"@slug"},{list:{isArray:!1,method:"GET",params:{count:24,page:"@page",divide:"@divide"},transformResponse:function(a){return JSON.parse(a)}}})}]),angular.module("riplive").factory("songTag",["$resource",function(a){return a("/api/songs/tag/:slug",{slug:"@slug"},{list:{isArray:!1,method:"GET",params:{count:24,page:"@page",divide:"@divide"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("tag",["$resource",function(a){return a("/api/tags/:slug",{slug:"@slug"},{list:{isArray:!1,method:"GET",params:{count:12,page:"@page"},transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").factory("user",["$resource",function(a){return a("/api/users/:uuid",{uuid:"@uuid"},{get:{isArray:!1,method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b}}})}]),angular.module("riplive").service("artistsService",["$injector",function(a){var b=a.get("artist"),c=a.get("artistGenre"),d=a.get("artistTag");return{getArtist:function(a,c){var d=b.get({slug:a});d.$promise.then(function(a){c(a)})},getArtists:function(a,c){var d=b.list(a);d.$promise.then(function(a){c(a)})},getArtistsByGenre:function(a,b){var d=c.list(a);d.$promise.then(function(a){b(a)})},getArtistsByTag:function(a,b){var c=d.list(a);c.$promise.then(function(a){b(a)})}}}]),angular.module("riplive").service("authorsService",["$injector",function(a){var b=a.get("author");return{getAuthor:function(a,c){var d=b.get({slug:a});d.$promise.then(function(a){c(a)})},getAuthors:function(a){var c=b.list();c.$promise.then(function(b){a(b)})}}}]),angular.module("riplive").service("chartsService",["$injector",function(a){var b=a.get("chart");return{getChart:function(a,c){var d=b.get({slug:a});d.$promise.then(function(a){c(a)})},getCharts:function(a){var c=b.list();c.$promise.then(function(b){a(b)})}}}]),angular.module("riplive").service("generalService",function(){var a=function(a,b){if(!(b instanceof Array))throw new Error("Pleas specify an array to be filled");for(var c=0,d=a.length;d>c;c++)b.push(a[c])},b=function(a,b){for(var c in a){b[c]instanceof Array||(b[c]=[]);for(var d=0;d<a[c].length;d++)b[c].push(a[c][d])}};return{pushToArray:a,pushToLetters:b}}),angular.module("riplive").service("genresService",["$injector",function(a){var b=a.get("genreSong");return{getSongsGenres:function(a){var c=b.list();c.$promise.then(function(b){a(b)})},getArtistsGenres:function(){}}}]),angular.module("riplive").service("highlightsService",["$injector",function(a){var b=a.get("highlight");return{getHighlights:function(a){var c=b.list();c.$promise.then(function(b){a(b)})}}}]),angular.module("riplive").service("newsService",["$injector",function(a){var b=a.get("news"),c=a.get("category"),d=a.get("tag");return{getNewsBySlug:function(a,c){var d=b.get({slug:a});d.$promise.then(function(a){c(a)})},getNews:function(a,c){var d=b.list(a);d.$promise.then(function(a){c(a)})},getNewsByCategory:function(a,b){var d=c.list(a);d.$promise.then(function(a){b(a)})},getNewsByTag:function(a,b){var c=d.list(a);c.$promise.then(function(a){b(a)})}}}]),angular.module("riplive").service("onAirChannel",["$rootScope",function(a){var b=["toggleOnAir","onAirStatus"],c=function(c,d){return-1===b.indexOf(c)?!1:(a.$broadcast(c,d),this)},d=function(a,b){return a.$on("toggleOnAir",function(a,c){b(a,c)}),this},e=function(a,b){return a.$on("onAirStatus",function(a,c){b(a,c)}),this};return{publish:c,onToggleOnAir:d,onOnAirStatus:e}}]),angular.module("riplive").service("playerChannel",["$rootScope",function(a){var b=["playPause","playerStatus","volumeUp","volumeOff"],c=function(c,d){return-1===b.indexOf(c)?!1:(a.$broadcast(c,d),this)},d=function(a,b){return a.$on("playPause",function(a,c){b(a,c)}),this},e=function(a,b){return a.$on("playerStatus",function(a,c){b(a,c)}),this},f=function(a,b){return a.$on("volumeUp",function(a,c){b(a,c)}),this},g=function(a,b){return a.$on("volumeOff",function(a,c){b(a,c)}),this};return{publish:c,onPlayPause:d,onPlayerStatus:e,onVolumeUp:f,onVolumeOff:g}}]),angular.module("riplive").service("podcastsService",["$injector",function(a){var b=a.get("podcast");return{getPodcast:function(a,c,d){var e=b.get({program_slug:a,id:c});e.$promise.then(function(a){d(a)})},getPodcasts:function(a,c){var d=b.list(a);d.$promise.then(function(a){c(a)})}}}]),angular.module("riplive").service("programsService",["$injector",function(a){var b=a.get("program"),c=a.get("schedule");return{getProgram:function(a,c){var d=b.get({slug:a});d.$promise.then(function(a){c(a)})},getPrograms:function(a,c){var d=b.list(a);d.$promise.then(function(a){c(a)})},getSchedule:function(a){var b=c.list();b.$promise.then(function(b){a(b)})}}}]),angular.module("riplive").service("searchService",["$injector",function(a){var b=a.get("search"),c={artists:{classes:"btn-artists fa-user",link:"/artists/"},charts:{classes:"btn-charts fa-bar-chart-o",link:"/charts/"},post:{classes:"btn-news fa-bullhorn",link:"/news/"},programs:{classes:"btn-programs fa-microphone",link:"/programs/"},songs:{classes:"btn-songs fa-headphones",link:"/songs/"}},d=["highlights","labels"],e=function(a){for(var b=0,e=a.length;e>b;b++)-1===d.indexOf(a[b].type)?-1!==Object.keys(c).indexOf(a[b].type)&&(a[b].classes=c[a[b].type].classes,a[b].link=c[a[b].type].link+a[b].slug):(a.splice(b,1),--e);return a};return{getSearchResults:function(a,c){var d=b.list(a);d.$promise.then(function(a){a.posts=e(a.posts),c(a)})}}}]),angular.module("riplive").service("sideMenuChannel",["$rootScope",function(a){var b=["toggleSideMenu","sideMenuStatus"],c=function(c,d){return-1===b.indexOf(c)?!1:(a.$broadcast(c,d),this)},d=function(a,b){return a.$on("toggleSideMenu",function(a,c){b(a,c)}),this},e=function(a,b){return a.$on("sideMenuStatus",function(a,c){b(a,c)}),this};return{publish:c,onToggleSideMenu:d,onSideMenuStatus:e}}]),angular.module("riplive").service("socketIo",function(){var a=function(a){var b=io(a);return b};return{io:io,connect:a}}),angular.module("riplive").service("songsService",["$injector",function(a){var b=a.get("song"),c=a.get("songGenre"),d=a.get("songTag");return{getSong:function(a,c){var d=b.get({slug:a});d.$promise.then(function(a){c(a)})},getSongs:function(a,c){var d=b.list(a);d.$promise.then(function(a){c(a)})},getSongsByGenre:function(a,b){var d=c.list(a);d.$promise.then(function(a){b(a)})},getSongsByTag:function(a,b){var c=d.list(a);c.$promise.then(function(a){b(a)})}}}]),angular.module("riplive").service("userService",["$injector","localStorageService",function(a,b){var c=a.get("user");return{getUser:function(){return c},getUserFromLocalStorage:function(){var a=b.get("user");return a},getUserByUuid:function(a,b){if(!d){var d=c.get({uuid:a});d.$promise.then(function(a){return b(a)})}},persistUserToLocalStorage:function(a){return b.add("user",a),this}}}]),angular.module("riplive").service("voteService",["$injector","localStorageService",function(a,b){var c=a.get("chartVote"),d=function(a){var c=b.get(a),d=new Date,e=d.setDate(d.getDate()-1);if(c){var f=new Date(c.voteDate);return f.getTime()>e?!1:!0}return!0},e=function(a,b){if(!d(a.id_song))return b({status:"error",message:"You can vote a song once a day!"});var e=c.save(a);e.$promise.then(function(a){b(a)})};return{userCanVoteSong:d,voteSong:e}}]),angular.module("riplive").controller("ArtistCtrl",["$scope","$routeParams","artistsService",function(a,b,c){var d=b.slug;c.getArtist(d,function(b){a.artist=b.artist})}]),angular.module("riplive").controller("ArtistsCtrl",["$scope","artistsService","generalService",function(a,b,c){var d=0,e={page:1,divide:!0};b.getArtists(e,function(b){d=b.pages,a.title="Artists",a.artists=b.artists}),a.loading=!0,a.loadData=function(){return e.page>=d?(a.loading=!1,!1):(e.page+=1,void b.getArtists(e,function(b){c.pushToLetters(b.artists,a.artists)}))}}]),angular.module("riplive").controller("ArtistsGenreCtrl",["$scope","$routeParams","artistsService","generalService",function(a,b,c,d){var e=b.slug,f=0,g={slug:e,page:1,divide:!0};c.getArtistsByGenre(g,function(b){f=b.pages,a.title="Artists",a.subtitle=b.genre.name,a.artists=b.artists}),a.loading=!0,a.loadData=function(){return g.page>=f?(a.loading=!1,!1):(g.page+=1,void c.getArtistsByGenre(g,function(b){d.pushToLetters(b.artists,a.artists)}))}}]),angular.module("riplive").controller("ArtistsTagCtrl",["$scope","$routeParams","artistsService","generalService",function(a,b,c,d){var e=b.slug,f=0,g={slug:e,page:1,divide:!0};c.getArtistsByTag(g,function(b){f=b.pages,a.title="Artists",a.subtitle=b.tag.name,a.artists=b.artists}),a.loading=!0,a.loadData=function(){return g.page>=f?(a.loading=!1,!1):(g.page+=1,void c.getArtistsByTag(g,function(b){d.pushToLetters(b.artists,a.artists)}))}}]),angular.module("riplive").controller("AuthorCtrl",["$scope","$routeParams","authorsService",function(a,b,c){var d=b.slug;c.getAuthor(d,function(b){a.author=b})}]),angular.module("riplive").controller("AuthorsCtrl",["$scope","authorsService",function(a,b){a.loading=!0,b.getAuthors(function(b){a.loading=!1,a.authors=b})}]),angular.module("riplive").controller("CategoriesCtrl",["$scope","$routeParams","newsService","generalService",function(a,b,c,d){var e=b.slug,f=1,g=0;c.getNewsByCategory({slug:e,page:f},function(b){g=b.pages,a.title="News",a.subtitle=b.category.title,a.posts=b.posts}),a.loading=!0,a.loadData=function(){return f>=g?(a.loading=!1,!1):(f+=1,void c.getNewsByCategory({slug:e,page:f},function(b){d.pushToArray(b.posts,a.posts)}))}}]),angular.module("riplive").controller("ChartCtrl",["$scope","$routeParams","chartsService",function(a,b,c){var d=b.slug;a.loading=!0,c.getChart(d,function(b){a.loading=!1,a.chart=b.complete_chart})}]),angular.module("riplive").controller("ChartsCtrl",["$scope","chartsService",function(a,b){a.loading=!0,b.getCharts(function(b){a.loading=!1,a.charts=b.complete_charts})}]),angular.module("riplive").controller("HighlightsCtrl",["$scope","highlightsService",function(a,b){b.getHighlights(function(b){a.highlights=b.highlights})}]),angular.module("riplive").controller("LoginCtrl",["$scope","$routeParams","$window","userService",function(a,b,c,d){var e="/api/auth/facebook",f=function(){a.success=!0,a.message="You are already logged in."},g=function(){a.success=!0,a.message="Thank you! You can now vote Riplive's charts."},h=function(){a.failure=!0,a.message="Cannot login. Please retry later."},i=function(){var b=c.open(e,"_blank","resizable=yes, scrollbars=yes, titlebar=yes");b.addEventListener("message",function(b){a.$apply(function(){return"success"!==b.data.status?h():void g()})})};if(c.opener&&b.uuid){c.opener.focus();var j=b.uuid;d.getUserByUuid(j,function(a){"ok"!==a.status&&(c.parent.postMessage({status:"failure"},"*"),c.close()),d.persistUserToLocalStorage(a),c.parent.postMessage({status:"success"},"*"),c.close()})}a.login=function(){var a=d.getUserFromLocalStorage();a?f():i()}}]),angular.module("riplive").controller("MainCtrl",["$scope","newsService","podcastsService","generalService",function(a,b,c,d){var e=1,f=0;a.loading=!0,c.getPodcasts({count:4},function(b){a.podcasts=b.podcasts}),b.getNews({page:e,count:26},function(b){f=b.pages,a.firsts=b.posts.splice(0,2),a.posts=b.posts}),a.loadData=function(){return e>=f?(a.loading=!1,!1):(e+=1,void b.getNews({page:e},function(b){d.pushToArray(b.posts,a.posts)}))}}]),angular.module("riplive").controller("NewsCtrl",["$scope","$routeParams","newsService","authorsService",function(a,b,c,d){var e=b.slug;c.getNewsBySlug(e,function(b){var c=b.previous_url?b.previous_url.split("/"):!1,e=b.next_url?b.next_url.split("/"):!1;a.news=b.post,a.news.previous_slug=e[3],a.news.next_slug=c[3],d.getAuthor(b.post.author.slug,function(b){a.author=b}),a.id=b.post.slug})}]),angular.module("riplive").controller("NewsListCtrl",["$scope","newsService","generalService",function(a,b,c){var d=1,e=0;b.getNews({page:d,count:26},function(b){e=b.pages,a.title="News",a.subtitle="",a.firsts=b.posts.splice(0,2),a.posts=b.posts}),a.loading=!0,a.loadData=function(){return d>=e?(a.loading=!1,!1):(d+=1,void b.getNews({page:d},function(b){c.pushToArray(b.posts,a.posts)}))}}]),angular.module("riplive").controller("OnAirCtrl",["$scope","socketIo",function(a,b){var c=b.connect("http://onair.riplive.it:8082"),d={program:"http://www.static.riplive.it/wp-content/uploads/2014/04/rip_authors.jpg",notFound:["http://www.static.riplive.it/wp-content/uploads/2014/03/vinyl-1.jpg","http://www.static.riplive.it/wp-content/uploads/2014/03/vinyl-2.jpg","http://www.static.riplive.it/wp-content/uploads/2014/03/vinyl-3.jpg","http://www.static.riplive.it/wp-content/uploads/2014/03/vinyl-4.jpg"]},e=function(){var a=Math.floor(Math.random()*d.notFound.length);return d.notFound[a]},f=function(b){a.$apply(function(){a.song=b})};c.on("error",function(){f(notFound)}),c.on("song",function(a){var b=JSON.parse(a);return"error"===b.status?(f({artist:"No song",title:"in archive",image:e()}),!1):"adv"===b.type?(f({artist:"No song",title:"in archive",image:e()}),!1):"programs"===b.type?(b.image=d.program,f(b),!1):void f({artist:b.artist,title:b.title,image:b.posts[0].thumbnail_images["landscape-medium"].url,images:b.posts[0].thumbnail_images,info:b.posts[0]})})}]),angular.module("riplive").controller("PhotosCtrl",["$scope","socketIo",function(a,b){var c=b.connect("http://onair.riplive.it:80");a.loading=!0,c.on("photos",function(b){console.log(b),a.$apply(function(){a.loading=!1,a.photos=b})}),c.on("photo",function(b){a.$apply(function(){a.photos.unshift(b)})})}]),angular.module("riplive").controller("PodcastCtrl",["$scope","$routeParams","podcastsService",function(a,b,c){var d=b.id,e=b.program_slug;c.getPodcast(e,d,function(b){a.podcast=b})}]),angular.module("riplive").controller("PodcastsCtrl",["$scope","$location","programsService","podcastsService","generalService",function(a,b,c,d,e){var f=1,g=0;a.podcasts=[];var h=function(){c.getPrograms({podcasts:!0},function(b){a.programs=b.programs})},i=function(){a.loading=!0;var b={page:f};d.getPodcasts(b,function(b){a.loading=!1,g=b.pages,e.pushToArray(b.podcasts,a.podcasts)})};a.$watch("currentProgram",function(a){if(a){var c="/podcasts/";c+="all_programs"===a?"":a,b.path(c)}}),a.loadData=function(){return f>=g?!1:(f+=1,void i())},h(),i()}]),angular.module("riplive").controller("PodcastsProgramCtrl",["$scope","$routeParams","$location","programsService","podcastsService","generalService",function(a,b,c,d,e,f){var g=0,h={page:1,program_slug:b.program_slug};a.podcasts=[];var i=function(){d.getPrograms({podcasts:!0},function(b){a.programs=b.programs})},j=function(){a.loading=!0,e.getPodcasts(h,function(b){g=b.pages,a.loading=!1,a.subtitle=b.podcasts[0].program_title,f.pushToArray(b.podcasts,a.podcasts)})};a.$watch("currentProgram",function(a){if(a){var b="/podcasts/";b+="all_programs"===a?"":a,c.path(b)}}),a.loadData=function(){return h.page>=g?!1:(h.page+=1,void j())},i(),j()}]),angular.module("riplive").controller("ProgramCtrl",["$scope","$routeParams","programsService",function(a,b,c){var d=b.slug;c.getProgram(d,function(b){a.program=b.program})}]),angular.module("riplive").controller("ProgramsCtrl",["$scope","programsService",function(a,b){a.loading=!0,b.getPrograms({},function(b){a.loading=!1,a.programs=b.programs})}]),angular.module("riplive").controller("ScheduleCtrl",["$scope","programsService",function(a,b){a.loading=!0,b.getSchedule(function(b){a.loading=!1,a.schedule=b})}]),angular.module("riplive").controller("SearchCtrl",["$scope","$routeParams","searchService","generalService",function(a,b,c,d){var e=b.search,f=0,g={search:e,page:1},h="You've searched for: "+e;return e?(c.getSearchResults(g,function(b){f=b.pages,a.loading=!1,a.posts=b.posts,0===b.posts.length&&(h="No results for: "+e),a.countTotal=b.count_total,a.subtitle=h}),a.loading=!0,void(a.loadData=function(){return g.page>=f?(a.loading=!1,!1):(g.page+=1,void c.getSearchResults(g,function(b){d.pushToArray(b.posts,a.posts)}))})):!1}]),angular.module("riplive").controller("SongCtrl",["$scope","$routeParams","songsService",function(a,b,c){var d=b.slug;c.getSong(d,function(b){a.song=b.song})}]),angular.module("riplive").controller("SongsCtrl",["$scope","$location","songsService","genresService","generalService",function(a,b,c,d,e){var f=0,g={page:1,divide:!0};d.getSongsGenres(function(b){a.songsGenres=b.genres}),c.getSongs(g,function(b){f=b.pages,a.title="Songs",a.songs=b.songs}),a.loading=!0,a.$watch("currentGenre",function(a){a&&b.path("/songs/genre/"+a.slug)}),a.loadData=function(){return g.page>=f?(a.loading=!1,!1):(g.page+=1,void c.getSongs(g,function(b){e.pushToLetters(b.songs,a.songs)}))}}]),angular.module("riplive").controller("SongsGenreCtrl",["$scope","$routeParams","$location","songsService","genresService","generalService",function(a,b,c,d,e,f){var g=b.slug,h=0,i={slug:g,page:1,divide:!0};e.getSongsGenres(function(b){a.songsGenres=b.genres}),d.getSongsByGenre(i,function(b){h=b.pages,a.title="Songs",a.subtitle=b.genre.name,a.songs=b.songs}),a.loading=!0,a.$watch("currentGenre",function(a){a&&c.path("/songs/genre/"+a.slug)}),a.loadData=function(){return i.page>=h?(a.loading=!1,!1):(i.page+=1,void d.getSongsByGenre(i,function(b){f.pushToLetters(b.songs,a.songs)}))}}]),angular.module("riplive").controller("SongsTagCtrl",["$scope","$routeParams","$location","songsService","genresService","generalService",function(a,b,c,d,e,f){var g=b.slug,h=0,i={slug:g,page:1,divide:!0};e.getSongsGenres(function(b){a.songsGenres=b.genres}),d.getSongsByTag(i,function(b){h=b.pages,a.title="Songs",a.subtitle=b.tag.name,a.songs=b.songs}),a.loading=!0,a.$watch("currentGenre",function(a){a&&c.path("/songs/genre/"+a.slug)}),a.loadData=function(){return i.page>=h?(a.loading=!1,!1):(i.page+=1,void d.getSongsByTag(i,function(b){f.pushToLetters(b.songs,a.songs)}))}}]),angular.module("riplive").controller("TagsCtrl",["$scope","$routeParams","newsService","generalService",function(a,b,c,d){var e=b.slug,f=1,g=0;c.getNewsByTag({slug:e},function(b){g=b.pages,a.title="News",a.subtitle=b.tag.title,a.posts=b.posts}),a.loading=!0,a.loadData=function(){if(f>=g)return a.loading=!1,!1;f+=1;var b={slug:e,page:f};c.getNewsByTag(b,function(b){d.pushToArray(b.posts,a.posts)})}}]),angular.module("riplive").directive("analytics",["$rootScope","$window","$location",function(a,b,c){return{restrict:"A",link:function(){var d=function(){b.ga("send","pageview",{page:c.path()})};a.$on("$routeChangeSuccess",d)}}}]),angular.module("riplive").directive("backOnTop",function(){return{templateUrl:"templates/back-on-top.html",restrict:"E",link:function(a,b){b.on("click",function(){$("html, body").animate({scrollTop:0},"slow")})}}}),angular.module("riplive").directive("photosControl",function(){return{templateUrl:"templates/photos-control.html",restrict:"E",link:function(a,b){var c=b.find(".btn span"),d=function(){c.removeClass("fa-ellipsis-h").addClass("fa-ellipsis-v"),angular.element(".media-block-instagram").removeClass("col-lg-4").addClass("media-block-instagram-large")};b.on("click",d)}}}),angular.module("riplive").directive("loadingSpinner",function(){return{templateUrl:"templates/loading-spinner.html",restrict:"E",replace:!0,scope:{visible:"="}}}),angular.module("riplive").directive("navControls",["playerChannel","sideMenuChannel","onAirChannel",function(a,b,c){return{templateUrl:"templates/nav-controls.html",replace:!0,restrict:"E",link:function(d,e){var f=e,g=e.find(".player-control"),h=e.find("#on-air-btn");d.toggleSideMenu=function(){b.publish("toggleSideMenu")},d.toggleOnAir=function(){c.publish("toggleOnAir")},d.playPause=function(){console.log("playPause"),a.publish("playPause")},d.volumeUp=function(){a.publish("volumeUp")},d.volumeOff=function(){a.publish("volumeOff")},a.onPlayerStatus(d,function(a,b){b.data===!0?g.removeClass("fa-play").addClass("fa-pause"):g.removeClass("fa-pause").addClass("fa-play")}),c.onOnAirStatus(d,function(a,b){b.data===!0?(f.addClass("slided"),h.removeClass("fa-level-up").addClass("fa-level-down")):(f.removeClass("slided"),h.removeClass("fa-level-down").addClass("fa-level-up"))})}}}]),angular.module("riplive").directive("search",["$location","$timeout","sideMenuChannel",function(a,b,c){return{templateUrl:"templates/search.html",restrict:"E",replace:"true",scope:{term:"@"},link:function(d,e){var f=e.find(".popover");d.search=function(){return d.term?(a.path("/search").search("search",d.term),void c.publish("toggleSideMenu")):(f.show(),b(function(){f.hide()},2500),!1)}}}}]),angular.module("riplive").directive("socialButtons",["$window",function(a){return{replace:!0,restrict:"E",templateUrl:"templates/social-buttons.html",scope:{href:"=",image:"=",title:"=",text:"="},link:function(b){var c="http://riplive.it";b.facebookShare=function(){var d="https://www.facebook.com/dialog/feed?app_id=1380026972276511&redirect_uri="+c+b.href+"&link="+c+b.href+"&picture="+b.image+"&caption="+b.title+"&description="+b.text+'&actions={"name":"Riplive.it - The next step", "link" :"http://www.riplive.it"}';a.open(d,"facebook-share-dialog","width=800,height=550")},b.twitterShare=function(){var d="https://twitter.com/intent/tweet?via=webrip&text="+encodeURIComponent(b.title)+"&hashtags=riplive&url="+encodeURIComponent(c+b.href);a.open(d,"twitter-share-dialog","width=800,height=550")}}}}]),angular.module("riplive").directive("songPicture",function(){return{replace:!0,restrict:"E",scope:{song:"="},templateUrl:"templates/song-picture.html"}}),angular.module("riplive").directive("streamingPlayer",["playerChannel",function(a){return{replace:!0,restrict:"E",scope:{audio:"=",autoplay:"=",showControls:"=",isStreaming:"="},templateUrl:"templates/streaming-player.html",link:function(b,c){var d=b.audio,e=(b.autoplay,b.isStreaming),f=1,g=!1,h=c.find(".player-hidden"),i=c.find(".player-control");b.$watch("audio",function(a){"undefined"!=typeof a&&h.jPlayer("setMedia",{mp3:a})}),h.jPlayer({ready:function(){"undefined"==typeof d&&(d=b.audio),$(this).jPlayer("setMedia",{mp3:d})},pause:function(){$(this).jPlayer(e?"clearMedia":"pause")},stop:function(){e||$(this).jPlayer("pause",0)},error:function(a){a.jPlayer.error.type===$.jPlayer.error.URL_NOT_SET&&$(this).jPlayer("setMedia",{mp3:d}).jPlayer("play")},swfPath:"js",supplied:"mp3",preload:"none",wmode:"window",cssSelectorAncestor:".player-container",cssSelector:{seekBar:".jp-seek-bar",currentTime:".jp-current-time",duration:".jp-duration"},toggleDuration:!0}).bind($.jPlayer.event.play,function(){$(this).jPlayer("pauseOthers",0)}),h.on($.jPlayer.event.play,function(){g=!0,i.removeClass("fa-play").addClass("fa-pause"),a.publish("playerStatus",{status:"ok",data:g})}),h.on($.jPlayer.event.pause,function(){g=!1,i.removeClass("fa-pause").addClass("fa-play"),a.publish("playerStatus",{status:"ok",data:g})}),h.on($.jPlayer.event.stop,function(){g=!1,i.removeClass("fa-pause").addClass("fa-play"),a.publish("playerStatus",{status:"ok",data:g})}),h.on($.jPlayer.event.error,function(b){i.removeClass("fa-pause").addClass("fa-play"),a.publish("playerStatus",{status:"error",data:b})}),b.playPause=function(){h.jPlayer(g===!1?"play":"pause")},b.stop=function(){h.jPlayer("stop")},b.volumeUp=function(){return f>=1?!1:(f+=.1,void h.jPlayer("volume",f))},b.volumeOff=function(){return 0>=f?!1:(f-=.1,void h.jPlayer("volume",f))},a.onPlayPause(b,function(){e&&b.playPause()}),a.onVolumeUp(b,function(){b.volumeUp()}),a.onVolumeOff(b,function(){b.volumeOff()})}}}]),angular.module("riplive").directive("toggleSideMenu",["$location","sideMenuChannel",function(a,b){return{restrict:"A",scope:{},link:function(a,c){var d=!1,e=c,f=angular.element("#inner-wrapper"),g=c.find(".side-menu-link"),h=angular.element(".navbar-toggle"),i=function(){d=!0,f.addClass("menu-open"),e.removeClass("menu-closed").addClass("menu-open"),h.removeClass("fa-bars").addClass("fa-times"),angular.element("#main").on("click",j)},j=function(){d=!1,f.removeClass("menu-open"),e.removeClass("menu-open").addClass("menu-closed"),h.removeClass("fa-times").addClass("fa-bars"),angular.element("#main").off("click",j)};b.onToggleSideMenu(a,function(){d===!1?i():j(),b.publish("sideMenuStatus",{status:"ok",data:d})}),g.on("click",j)}}}]),angular.module("riplive").directive("toggleOnAir",["onAirChannel",function(a){return{restrict:"A",link:function(b,c){var d=!1,e=c.parent("#on-air"),f=document.documentElement.clientHeight,g=function(){d=!0,angular.element("div#main").height(f),e.removeClass("on-air-closed")},h=function(){d=!1,angular.element("div#main").height("auto"),e.addClass("on-air-closed")};a.onToggleOnAir(b,function(){d===!1?g():h(),a.publish("onAirStatus",{status:"ok",data:d})})}}}]),angular.module("riplive").directive("topHighlights",["$window","$rootScope","$location","onAirChannel",function(){return{templateUrl:"templates/top-highlights.html",replace:!0,restrict:"E"}}]),angular.module("riplive").directive("whenScrolled",["$window","$document",function(a,b){return{restrict:"A",link:function(c,d,e){var f=angular.element(a),g=angular.element(b),h=function(){f.scrollTop()+50>g.height()-f.height()&&c.$apply(e.whenScrolled)};f.on("scroll",h),c.$on("$routeChangeStart",function(){f.off("scroll",h)})}}}]),angular.module("riplive").directive("voteSong",["$location","voteService","userService","localStorageService",function(a,b,c,d){return{templateUrl:"templates/vote-song.html",replace:!0,restrict:"E",scope:{idSong:"=",chartArchiveSlug:"=",userVote:"="},link:function(e,f){var g=f.find(".btn-like"),h=f.find(".fa-heart"),i=f.find(".popover"),j=f.find(".popover-content"),k=function(a){j.text(a),i.fadeIn(function(){angular.element(this).delay(1500).fadeOut(1e3)
})},l=function(){h.removeClass("fa-heart").addClass("fa-spinner")},m=function(){h.removeClass("fa-spinner").addClass("fa-heart")},n=function(){var f=c.getUserFromLocalStorage();if(!f)return e.$apply(function(){a.path("/login")});l();var g={id_song:e.idSong,chart_archive_slug:e.chartArchiveSlug,uuid_user:f.user.uuid,username:f.user.username};b.voteSong(g,function(a){return m(),"error"===a.status?k("You can vote a song once a day!"):(e.userVote+=1,d.set(e.idSong,{voteDate:new Date}),void k("Thank you!"))})};g.on("click",n)}}}]),angular.module("riplive").filter("dateFormat",["$filter",function(a){return function(b){if(b){var c=new Date(b.replace(/-/g,"/"));return a("date")(c,"dd MMMM yyyy")}}}]),angular.module("riplive").filter("nl2br",function(){return function(a){return a?a.replace(/\n/g,"<br/>"):void 0}}),angular.module("riplive").filter("unsafeHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("riplive").filter("stripHtml",function(){return function(a){return a?String(a).replace(/<[^>]+>/gm,""):void 0}});